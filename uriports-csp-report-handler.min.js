/*
 * MIT License
 *
 * Copyright (c) 2024 URIports B.V. https://www.uriports.com
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

!function(){const e=new Set;document.addEventListener("securitypolicyviolation",(function(t){const r=document.getElementById("uriports-csp-report-config");if(!r)return;let n;try{n=JSON.parse(r.textContent)}catch(e){return void console.error("Failed to parse CSP report config:",e)}const o=n.fraction??1;if(Math.random()>o)return;if(t.sourceFile&&/^((moz|chrome)-extension):\/\//.test(t.sourceFile))return;if(n.ignorePatterns&&Array.isArray(n.ignorePatterns)&&n.ignorePatterns.some((e=>t.blockedURI?.includes(e)||t.sourceFile?.includes(e)||t.documentURI?.includes(e))))return;const i=btoa(`${t.blockedURI||""}|${t.documentURI||""}|${t.effectiveDirective||""}|${t.sourceFile||""}`);if(e.has(i))return;e.add(i);const l=n.subdomain;if(!l)return;const c=[{age:0,body:{blockedURL:t.blockedURI??null,columnNumber:t.columnNumber??null,documentURL:t.documentURI??null,disposition:t.disposition??null,effectiveDirective:t.effectiveDirective??null,lineNumber:t.lineNumber??null,originalPolicy:t.originalPolicy??null,referrer:t.referrer??null,sample:t.sample??null,sourceFile:t.sourceFile??null,statusCode:t.statusCode??null},type:"csp-violation",url:t.documentURI??null,user_agent:navigator.userAgent??null}];fetch(`https://${l}.uriports.com/reports/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).catch((e=>console.error("Failed to send CSP report:",e)))}))}();