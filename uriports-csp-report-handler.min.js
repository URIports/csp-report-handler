/*
 * MIT License
 *
 * Copyright (c) 2024 URIports B.V. https://www.uriports.com
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

!function(){const e=new Set;document.addEventListener("securitypolicyviolation",(function(r){const t=document.getElementById("uriports-csp-report-config");if(!t)return;let o;try{o=JSON.parse(t.textContent)}catch(e){return void console.error("Failed to parse CSP report config:",e)}const n=o.fraction??1;if(Math.random()>n)return;if(r.sourceFile&&/^((moz|chrome)-extension):\/\//.test(r.sourceFile))return;if(o.ignorePatterns&&Array.isArray(o.ignorePatterns)&&o.ignorePatterns.some((e=>r.blockedURI?.includes(e)||r.sourceFile?.includes(e)||r.documentURI?.includes(e))))return;const i=btoa(`${r.blockedURI||""}|${r.documentURI||""}|${r.effectiveDirective||""}|${r.sourceFile||""}`);if(e.has(i))return;e.add(i);const l=o.subdomain;if(!l)return;const c={"csp-report":{blockedURL:r.blockedURI??null,columnNumber:r.columnNumber??null,documentURL:r.documentURI??null,effectiveDirective:r.effectiveDirective??null,lineNumber:r.lineNumber??null,originalPolicy:r.originalPolicy??null,sourceFile:r.sourceFile??null,statusCode:r.statusCode??null,referrer:r.referrer??null,sample:r.sample??null,disposition:r.disposition??null,fraction:n??null}};fetch(`https://${l}.uriports.com/reports/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).catch((e=>console.error("Failed to send CSP report:",e)))}))}();